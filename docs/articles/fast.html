<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fast LD Estimation • ldsep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fast LD Estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ldsep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fast.html">Fast LD Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/vcf.html">LD Estimation Pipeline from VCF</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dcgerard/ldsep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fast LD Estimation</h1>
                        <h4 data-toc-skip class="author">David
Gerard</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dcgerard/ldsep/blob/HEAD/vignettes/fast.Rmd" class="external-link"><code>vignettes/fast.Rmd</code></a></small>
      <div class="d-none name"><code>fast.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<p>We demonstrate our new moment-based linkage disequilibrium (LD)
estimators, as implemented in the <code><a href="../reference/ldfast.html">ldfast()</a></code> function. These
methods are described in detail in Gerard (2021). The following code
chunks are only evaluated if <a href="https://github.com/dcgerard/updog/" class="external-link">updog</a> is installed with a
version of at least 2.0.2.</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>We will load the packages and data that we will need</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dcgerard/updog/" class="external-link">updog</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dcgerard.github.io/ldsep/">ldsep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot" class="external-link">corrplot</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; corrplot 0.95 loaded</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"uit"</span>, package <span class="op">=</span> <span class="st">"ldsep"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">uit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "multidog"</span></span></code></pre></div>
<p>We need the posterior probabilities for each genotype for each
individual at each SNP. In <a href="https://github.com/dcgerard/updog/" class="external-link">updog</a>, this corresponds to the
<code>Pr_n</code> variables in its output, where <code>n</code> varies
from 0 to the ploidy. We can use <code><a href="https://rdrr.io/pkg/updog/man/format_multidog.html" class="external-link">updog::format_multidog()</a></code>
to extract these values into an array with the proper dimensions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ploidy</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/updog/man/format_multidog.html" class="external-link">format_multidog</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">uit</span>, varname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Pr_"</span>, <span class="fl">0</span><span class="op">:</span><span class="va">ploidy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "array"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">gp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 84  5</span></span></code></pre></div>
<p>The first dimension indexes the SNPs, the second dimension indexes
the individuals, and the third dimension indexes the possible dosages.
So <code>gp[i, j, k]</code> contains the posterior probability that
individual <code>j</code> has dosage <code>k-1</code> at SNP
<code>i</code>.</p>
<p>You can use other genotyping programs to obtain these posterior
probabilities, but they have to be formatted as an array with the
dimensions in the correct order (SNPs by individuals by dosages).</p>
<p><strong>However</strong>, in order for these estimates to perform
well, you need to use posterior genotype probabilities that have been
calculated using adaptive priors, i.e. empirical/hierarchical Bayes
approaches. There are many approaches that do this, such as <a href="https://cran.r-project.org/package=updog" class="external-link"><code>{updog}</code></a>,
<a href="https://cran.r-project.org/package=polyRAD" class="external-link"><code>{polyRAD}</code></a>,
<a href="https://cran.r-project.org/package=fitPoly" class="external-link"><code>{fitPoly}</code></a>,
or <a href="https://github.com/guilherme-pereira/vcf2sm" class="external-link"><code>{SuperMASSA}</code></a>.
Note that GATK uses a uniform prior, so would be inappropriate for use
in <code><a href="../reference/ldfast.html">ldfast()</a></code>.</p>
<p>Let’s use our genotype posterior probabilities (<code>gp</code>) to
estimate LD.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ldout</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ldfast.html">ldfast</a></span><span class="op">(</span>gp <span class="op">=</span> <span class="va">gp</span>, type <span class="op">=</span> <span class="st">"r2"</span><span class="op">)</span></span></code></pre></div>
<p><code>ldout</code> contains:</p>
<ul>
<li>
<p><code>ldmat</code>: The estimated squared correlation
coefficients, adjusted for genotype uncertainty.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span>corr <span class="op">=</span> <span class="va">ldout</span><span class="op">$</span><span class="va">ldmat</span>, </span>
<span>         method <span class="op">=</span> <span class="st">"color"</span>, </span>
<span>         type <span class="op">=</span> <span class="st">"upper"</span>,</span>
<span>         diag <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         tl.pos <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fast_files/figure-html/unnamed-chunk-4-1.png" alt="Heat map of r-squared" width="700"></p>
</li>
<li>
<p><code>semat</code>: The estimated standard errors for the squared
correlation coefficient estimates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span>corr <span class="op">=</span> <span class="va">ldout</span><span class="op">$</span><span class="va">semat</span>, </span>
<span>         method <span class="op">=</span> <span class="st">"color"</span>, </span>
<span>         type <span class="op">=</span> <span class="st">"upper"</span>,</span>
<span>         diag <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         tl.pos <span class="op">=</span> <span class="st">"n"</span>, </span>
<span>         is.corr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="fast_files/figure-html/unnamed-chunk-5-1.png" alt="Heat map of standard errors of r-squared" width="700"></p>
</li>
<li>
<p><code>rr</code>: The estimated “reliability ratios”, the
multiplicative effects applied to the naive LD estimates using just the
posterior mean genotypes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ldout</span><span class="op">$</span><span class="va">rr</span>, </span>
<span>               main <span class="op">=</span> <span class="st">"Reliability Ratios"</span>, </span>
<span>               xlab <span class="op">=</span> <span class="st">"Reliability Ratios"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fast_files/figure-html/unnamed-chunk-6-1.png" alt="Histogram of reliability ratios" width="700"></p>
</li>
</ul>
<p>The slowest part of <code><a href="../reference/ldfast.html">ldfast()</a></code> is using hierarchical
shrinkage on the log of the reliability ratios
(<code>shrinkrr = TRUE</code>), but I wouldn’t disable this as some
reliability ratios have high variance and are greatly improved through
shrinkage.</p>
<p>Other LD estimators are available: <code>D</code>,
<code>Dprime</code>, <code>r</code>, and <code>z</code>. See the help
file of <code><a href="../reference/ldfast.html">ldfast()</a></code> for details.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Gerard, David (2021). “Scalable Bias-corrected Linkage
Disequilibrium Estimation Under Genotype Uncertainty.”
<em>Heredity</em>, <em>127</em>(4), 357–362. <a href="https://doi.org/10.1038/s41437-021-00462-5" class="external-link">doi:10.1038/s41437-021-00462-5</a>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Gerard.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
